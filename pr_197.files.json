[
  {
    "sha": "18d9b62e97b44027fb0f0db0f93a18d122f30e3a",
    "filename": "Cargo.lock",
    "status": "modified",
    "additions": 23,
    "deletions": 0,
    "changes": 23,
    "blob_url": "https://github.com/acaradonna/goblin-camp/blob/33984731f37b73c8d1a3240c86722df05bcc5e30/Cargo.lock",
    "raw_url": "https://github.com/acaradonna/goblin-camp/raw/33984731f37b73c8d1a3240c86722df05bcc5e30/Cargo.lock",
    "contents_url": "https://api.github.com/repos/acaradonna/goblin-camp/contents/Cargo.lock?ref=33984731f37b73c8d1a3240c86722df05bcc5e30",
    "patch": "@@ -118,6 +118,12 @@ version = \"1.5.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"c08606f8c3cbf4ce6ec8e28fb0014a2c086708fe954eaa885384a6165172e7e8\"\n \n+[[package]]\n+name = \"base64\"\n+version = \"0.21.7\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"9d297deb1925b89f2ccc13d7635fa0714f12c87adce1c75356b39ca9b7178567\"\n+\n [[package]]\n name = \"bevy_ecs\"\n version = \"0.14.2\"\n@@ -238,6 +244,9 @@ name = \"bitflags\"\n version = \"2.9.3\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"34efbcccd345379ca2868b2b2c9d3782e9cc58ba87bc7d79d5b53d9c9ae6f25d\"\n+dependencies = [\n+ \"serde\",\n+]\n \n [[package]]\n name = \"bumpalo\"\n@@ -593,11 +602,13 @@ name = \"gc_core\"\n version = \"0.1.0\"\n dependencies = [\n  \"bevy_ecs\",\n+ \"ciborium\",\n  \"criterion\",\n  \"lru\",\n  \"noise\",\n  \"pathfinding\",\n  \"rand\",\n+ \"ron\",\n  \"serde\",\n  \"serde_json\",\n  \"thiserror 1.0.69\",\n@@ -1110,6 +1121,18 @@ version = \"0.8.6\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"caf4aa5b0f434c91fe5c7f1ecb6a5ece2130b02ad2a590589dda5146df959001\"\n \n+[[package]]\n+name = \"ron\"\n+version = \"0.8.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"b91f7eff05f748767f183df4320a63d6936e9c6107d97c9e6bdd9784f4289c94\"\n+dependencies = [\n+ \"base64\",\n+ \"bitflags\",\n+ \"serde\",\n+ \"serde_derive\",\n+]\n+\n [[package]]\n name = \"rustc-hash\"\n version = \"2.1.1\""
  },
  {
    "sha": "cd0219d07818c9071bd2ebff5d35e65cc0637865",
    "filename": "crates/gc_cli/src/main.rs",
    "status": "modified",
    "additions": 47,
    "deletions": 10,
    "changes": 57,
    "blob_url": "https://github.com/acaradonna/goblin-camp/blob/33984731f37b73c8d1a3240c86722df05bcc5e30/crates%2Fgc_cli%2Fsrc%2Fmain.rs",
    "raw_url": "https://github.com/acaradonna/goblin-camp/raw/33984731f37b73c8d1a3240c86722df05bcc5e30/crates%2Fgc_cli%2Fsrc%2Fmain.rs",
    "contents_url": "https://api.github.com/repos/acaradonna/goblin-camp/contents/crates%2Fgc_cli%2Fsrc%2Fmain.rs?ref=33984731f37b73c8d1a3240c86722df05bcc5e30",
    "patch": "@@ -50,6 +50,10 @@ struct Args {\n     #[arg(long, default_value_t = false)]\n     show_vis: bool,\n \n+    /// Codec for save/load demo: json|ron|cbor (default: json)\n+    #[arg(long, default_value = \"json\")]\n+    codec: String,\n+\n     /// Choose a demo to run. If omitted or set to `menu`, an interactive picker is shown.\n     #[command(subcommand)]\n     demo: Option<Demo>,\n@@ -330,16 +334,49 @@ fn run_demo_jobs(args: &Args) -> Result<()> {\n fn run_demo_save(args: &Args) -> Result<()> {\n     let mut world = build_world(args);\n     let save = save_world(&mut world);\n-    let json = serde_json::to_string(&save)?;\n-    println!(\"Serialized save length: {} bytes\", json.len());\n-    let parsed: save::SaveGame = serde_json::from_str(&json)?;\n-    let mut world2 = World::new();\n-    load_world(parsed, &mut world2);\n-    println!(\n-        \"Reloaded world with {}x{} map.\",\n-        world2.resource::<GameMap>().width,\n-        world2.resource::<GameMap>().height\n-    );\n+    match args.codec.as_str() {\n+        \"json\" => {\n+            let data = save::encode_json(&save)?;\n+            println!(\"Serialized (json) length: {} bytes\", data.len());\n+            let parsed: save::SaveGame = save::decode_json(&data)?;\n+            let mut world2 = World::new();\n+            load_world(parsed, &mut world2);\n+            println!(\n+                \"Reloaded world with {}x{} map.\",\n+                world2.resource::<GameMap>().width,\n+                world2.resource::<GameMap>().height\n+            );\n+        }\n+        \"ron\" => {\n+            let data = save::encode_ron(&save).map_err(|e| anyhow::anyhow!(e))?;\n+            println!(\"Serialized (ron) length: {} bytes\", data.len());\n+            let parsed: save::SaveGame = save::decode_ron(&data).map_err(|e| anyhow::anyhow!(e))?;\n+            let mut world2 = World::new();\n+            load_world(parsed, &mut world2);\n+            println!(\n+                \"Reloaded world with {}x{} map.\",\n+                world2.resource::<GameMap>().width,\n+                world2.resource::<GameMap>().height\n+            );\n+        }\n+        \"cbor\" => {\n+            let bytes = save::encode_cbor(&save).map_err(|e| anyhow::anyhow!(e))?;\n+            println!(\"Serialized (cbor) length: {} bytes\", bytes.len());\n+            let parsed: save::SaveGame =\n+                save::decode_cbor(&bytes).map_err(|e| anyhow::anyhow!(e))?;\n+            let mut world2 = World::new();\n+            load_world(parsed, &mut world2);\n+            println!(\n+                \"Reloaded world with {}x{} map.\",\n+                world2.resource::<GameMap>().width,\n+                world2.resource::<GameMap>().height\n+            );\n+        }\n+        other => {\n+            println!(\"Unknown codec '{}'\", other);\n+            println!(\"Use one of: json|ron|cbor (default json)\");\n+        }\n+    }\n     Ok(())\n }\n "
  },
  {
    "sha": "89627b10020b1fa71241c9e2c6c86ecaf5bdb679",
    "filename": "crates/gc_core/Cargo.toml",
    "status": "modified",
    "additions": 2,
    "deletions": 0,
    "changes": 2,
    "blob_url": "https://github.com/acaradonna/goblin-camp/blob/33984731f37b73c8d1a3240c86722df05bcc5e30/crates%2Fgc_core%2FCargo.toml",
    "raw_url": "https://github.com/acaradonna/goblin-camp/raw/33984731f37b73c8d1a3240c86722df05bcc5e30/crates%2Fgc_core%2FCargo.toml",
    "contents_url": "https://api.github.com/repos/acaradonna/goblin-camp/contents/crates%2Fgc_core%2FCargo.toml?ref=33984731f37b73c8d1a3240c86722df05bcc5e30",
    "patch": "@@ -11,6 +11,8 @@ authors = [\"Goblin Camp Contributors\"]\n bevy_ecs = \"0.14\"\n serde = { version = \"1.0\", features = [\"derive\"] }\n serde_json = \"1.0\"\n+ron = \"0.8\"\n+ciborium = { version = \"0.2\", features = [\"std\"] }\n rand = \"0.8\"\n thiserror = \"1.0\"\n pathfinding = \"4.9.0\""
  },
  {
    "sha": "a9f5e42b978d500d07ed11c185af584b1a95657e",
    "filename": "crates/gc_core/src/components.rs",
    "status": "modified",
    "additions": 1,
    "deletions": 1,
    "changes": 2,
    "blob_url": "https://github.com/acaradonna/goblin-camp/blob/33984731f37b73c8d1a3240c86722df05bcc5e30/crates%2Fgc_core%2Fsrc%2Fcomponents.rs",
    "raw_url": "https://github.com/acaradonna/goblin-camp/raw/33984731f37b73c8d1a3240c86722df05bcc5e30/crates%2Fgc_core%2Fsrc%2Fcomponents.rs",
    "contents_url": "https://api.github.com/repos/acaradonna/goblin-camp/contents/crates%2Fgc_core%2Fsrc%2Fcomponents.rs?ref=33984731f37b73c8d1a3240c86722df05bcc5e30",
    "patch": "@@ -58,7 +58,7 @@ pub struct DesignationLifecycle(pub DesignationState);\n /// Types of items that can exist in the world\n /// This enum defines all possible item types that can be created,\n /// carried, and stored in stockpiles. Currently only Stone is implemented.\n-#[derive(Debug, Clone, Copy, PartialEq, Eq, Serialize, Deserialize)]\n+#[derive(Debug, Clone, Copy, PartialEq, Eq, PartialOrd, Ord, Serialize, Deserialize)]\n pub enum ItemType {\n     /// Stone items created from mining operations\n     /// These are the primary resource produced by mining wall tiles"
  },
  {
    "sha": "f2d40ad18cd7b527ba5b9dbbb2765328d2d885ef",
    "filename": "crates/gc_core/src/save.rs",
    "status": "modified",
    "additions": 64,
    "deletions": 0,
    "changes": 64,
    "blob_url": "https://github.com/acaradonna/goblin-camp/blob/33984731f37b73c8d1a3240c86722df05bcc5e30/crates%2Fgc_core%2Fsrc%2Fsave.rs",
    "raw_url": "https://github.com/acaradonna/goblin-camp/raw/33984731f37b73c8d1a3240c86722df05bcc5e30/crates%2Fgc_core%2Fsrc%2Fsave.rs",
    "contents_url": "https://api.github.com/repos/acaradonna/goblin-camp/contents/crates%2Fgc_core%2Fsrc%2Fsave.rs?ref=33984731f37b73c8d1a3240c86722df05bcc5e30",
    "patch": "@@ -2,6 +2,33 @@ use crate::components::{Carriable, Item, ItemType};\n use crate::world::{GameMap, Name, Position, TileKind, Velocity};\n use bevy_ecs::prelude::*;\n use serde::{Deserialize, Serialize};\n+use std::io::Cursor;\n+\n+/// Sort entity records in a stable, deterministic order.\n+///\n+/// Ordering key: (name, pos, vel, item_type, carriable)\n+fn sort_entities_deterministically(entities: &mut Vec<EntityData>) {\n+    use std::cmp::Ordering;\n+    entities.sort_by(|a, b| {\n+        let name_ord = a.name.cmp(&b.name);\n+        if name_ord != Ordering::Equal {\n+            return name_ord;\n+        }\n+        let pos_ord = a.pos.cmp(&b.pos);\n+        if pos_ord != Ordering::Equal {\n+            return pos_ord;\n+        }\n+        let vel_ord = a.vel.cmp(&b.vel);\n+        if vel_ord != Ordering::Equal {\n+            return vel_ord;\n+        }\n+        let item_ord = a.item_type.cmp(&b.item_type);\n+        if item_ord != Ordering::Equal {\n+            return item_ord;\n+        }\n+        a.carriable.cmp(&b.carriable)\n+    });\n+}\n \n #[derive(Serialize, Deserialize)]\n pub struct SaveGame {\n@@ -44,6 +71,8 @@ pub fn save_world(world: &mut World) -> SaveGame {\n             carriable: carriable.is_some(),\n         });\n     }\n+    // Deterministic ordering across codecs and runs\n+    sort_entities_deterministically(&mut entities);\n     SaveGame {\n         width,\n         height,\n@@ -77,3 +106,38 @@ pub fn load_world(save: SaveGame, world: &mut World) {\n         }\n     }\n }\n+\n+// --- Minimal codec helpers (format-agnostic call sites) ---\n+\n+/// Encode a SaveGame to JSON string\n+pub fn encode_json(save: &SaveGame) -> Result<String, serde_json::Error> {\n+    serde_json::to_string(save)\n+}\n+\n+/// Decode a SaveGame from JSON string\n+pub fn decode_json(s: &str) -> Result<SaveGame, serde_json::Error> {\n+    serde_json::from_str(s)\n+}\n+\n+/// Encode a SaveGame to RON string\n+pub fn encode_ron(save: &SaveGame) -> Result<String, ron::Error> {\n+    ron::ser::to_string(save)\n+}\n+\n+/// Decode a SaveGame from RON string\n+pub fn decode_ron(s: &str) -> Result<SaveGame, ron::Error> {\n+    ron::de::from_str(s).map_err(ron::Error::from)\n+}\n+\n+/// Encode a SaveGame to CBOR bytes\n+pub fn encode_cbor(save: &SaveGame) -> Result<Vec<u8>, ciborium::ser::Error<std::io::Error>> {\n+    let mut buf = Vec::new();\n+    ciborium::ser::into_writer(save, &mut buf)?;\n+    Ok(buf)\n+}\n+\n+/// Decode a SaveGame from CBOR bytes\n+pub fn decode_cbor(bytes: &[u8]) -> Result<SaveGame, ciborium::de::Error<std::io::Error>> {\n+    let mut cur = Cursor::new(bytes);\n+    ciborium::de::from_reader(&mut cur)\n+}"
  },
  {
    "sha": "6dd806b6b3098a3965c04672bac701775bd5c111",
    "filename": "crates/gc_core/tests/determinism_tests.rs",
    "status": "modified",
    "additions": 23,
    "deletions": 0,
    "changes": 23,
    "blob_url": "https://github.com/acaradonna/goblin-camp/blob/33984731f37b73c8d1a3240c86722df05bcc5e30/crates%2Fgc_core%2Ftests%2Fdeterminism_tests.rs",
    "raw_url": "https://github.com/acaradonna/goblin-camp/raw/33984731f37b73c8d1a3240c86722df05bcc5e30/crates%2Fgc_core%2Ftests%2Fdeterminism_tests.rs",
    "contents_url": "https://api.github.com/repos/acaradonna/goblin-camp/contents/crates%2Fgc_core%2Ftests%2Fdeterminism_tests.rs?ref=33984731f37b73c8d1a3240c86722df05bcc5e30",
    "patch": "@@ -79,6 +79,29 @@ fn deterministic_behavior_across_systems() {\n     );\n }\n \n+/// Save ordering is stable regardless of entity creation order\n+#[test]\n+fn deterministic_save_entity_ordering() {\n+    let mut world_a = World::new();\n+    world_a.insert_resource(GameMap::new(8, 8));\n+    // Insert in A order\n+    world_a.spawn((Name(\"B\".into()), Position(2, 2)));\n+    world_a.spawn((Name(\"A\".into()), Position(1, 1)));\n+    let save_a = save_world(&mut world_a);\n+\n+    let mut world_b = World::new();\n+    world_b.insert_resource(GameMap::new(8, 8));\n+    // Insert in B order (reverse)\n+    world_b.spawn((Name(\"A\".into()), Position(1, 1)));\n+    world_b.spawn((Name(\"B\".into()), Position(2, 2)));\n+    let save_b = save_world(&mut world_b);\n+\n+    // JSON bytes should be identical once encoded due to stable ordering\n+    let json_a = serde_json::to_string(&save_a).unwrap();\n+    let json_b = serde_json::to_string(&save_b).unwrap();\n+    assert_eq!(json_a, json_b, \"Save ordering should be deterministic\");\n+}\n+\n /// Test that the DeterministicRng resource produces consistent sequences\n #[test]\n fn deterministic_rng_consistent_sequences() {"
  }
]
